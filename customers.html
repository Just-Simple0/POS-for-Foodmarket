<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POS System - Customers</title>
    <!-- 공통 parts 삽입 -->
    <link rel="stylesheet" href="css/common.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css"
    />
    <script>
      window.CF_TURNSTILE_SITEKEY = "0x4AAAAAABtE3GFMWF3_Fd4E";
    </script>
    <!-- SheetUS 삽입 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- firebase parts 삽입 -->
    <script type="module" src="js/components/firebase-config.js"></script>
    <!-- 개별 css, js 삽입 -->
    <link rel="stylesheet" href="css/customers.css" />
    <script type="module" src="js/customers.js" defer></script>
  </head>
  <body>
    <div id="header-container"></div>

    <main class="container">
      <h2>이용자 조회</h2>
      <div id="top-bar">
        <div class="search-bar">
          <input id="global-search" placeholder="전체 검색 (이름, 주소 등)" />

          <label>
            <input type="checkbox" id="exact-match" /> 정확한 검색
          </label>

          <button id="toggle-advanced-search">고급 검색 열기</button>
        </div>

        <div id="advanced-search" class="hidden">
          <select id="field-select">
            <option value="">필드 선택</option>
            <option value="id">이용자ID</option>
            <option value="name">이용자명</option>
            <option value="birth">생년월일</option>
            <option value="gender">성별</option>
            <option value="status">상태</option>
            <option value="address">주소</option>
            <option value="phone">전화번호</option>
            <option value="type">이용자구분</option>
            <option value="category">이용자분류</option>
          </select>
          <input id="field-search" placeholder="선택 필드 검색" />
        </div>
      </div>

      <div class="list-header">
        <h2>이용자 목록</h2>
        <!-- 상단 툴바 -->
        <div class="customers-toolbar">
          <div class="left">
            <button id="btn-customer-create" class="btn btn-primary">
              <i class="fas fa-user-plus"></i> 등록하기
            </button>
            <button id="btn-export-xlsx" class="btn">
              <i class="fas fa-file-export"></i> 내보내기
            </button>
          </div>
          <div class="right admin-only" title="관리자 전용">
            <!-- 선택 삭제는 이후 확장 가능, 일단 행별 삭제 아이콘 제공 -->
          </div>
        </div>
      </div>

      <div class="table-wrapper">
        <table id="customer-table">
          <thead id="customers-thead">
            <tr>
              <th data-label="이용자명">이용자명</th>
              <th data-label="생년월일">생년월일</th>
              <th data-label="성별">성별</th>
              <th data-label="상태" class="th-admin-only">상태</th>
              <th data-label="행정구역">행정구역</th>
              <th data-label="주소">주소</th>
              <th data-label="전화번호">전화번호</th>
              <th data-label="이용자구분" class="th-admin-only">이용자구분</th>
              <th data-label="이용자분류" class="th-admin-only">이용자분류</th>
              <th data-label="비고">비고</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="pagination" class="pagination"></div>
    </main>

    <!-- 등록하기 모달 (직접 입력 / 엑셀 업로드) -->
    <div
      id="customer-create-modal"
      class="modal hidden modal--customer"
      aria-hidden="true"
    >
      <div
        class="modal-content"
        role="dialog"
        aria-modal="true"
        aria-labelledby="create-modal-title"
      >
        <div class="modal-header">
          <h2 id="create-modal-title">
            <i class="fas fa-user-plus"></i> 이용자 등록
          </h2>
        </div>
        <div class="modal-body">
          <div class="tabs">
            <button class="tab active" data-tab="direct">직접 입력</button>
            <button class="tab" data-tab="upload">엑셀 업로드</button>
          </div>
          <div class="tab-panel" id="tab-direct">
            <div class="grid2">
              <label>이용자명<input id="create-name" type="text" /></label>
              <label
                >생년월일<input
                  id="create-birth"
                  type="text"
                  placeholder="YYYY.MM.DD"
              /></label>
              <label
                >성별
                <select id="create-gender">
                  <option value="">-</option>
                  <option>남</option>
                  <option>여</option>
                </select>
              </label>
              <label
                >상태
                <select id="create-status">
                  <option>지원</option>
                  <option>제외</option>
                  <option>사망</option>
                </select>
              </label>
              <label
                >행정구역<input
                  id="create-region1"
                  type="text"
                  placeholder="예: 서울특별시"
              /></label>
              <label>주소<input id="create-address" type="text" /></label>
              <label
                >전화번호<input
                  id="create-phone"
                  type="text"
                  placeholder="010-0000-0000"
              /></label>
              <label>이용자구분<input id="create-type" type="text" /></label>
              <label
                >이용자분류<input id="create-category" type="text"
              /></label>
              <label>비고<input id="create-note" type="text" /></label>
            </div>
            <div class="modal-buttons">
              <button
                type="button"
                id="create-modal-save"
                class="btn btn-primary"
              >
                <i class="fas fa-save"></i> 저장
              </button>
              <button type="button" id="create-modal-close" class="btn">
                닫기
              </button>
            </div>
          </div>

          <div class="tab-panel hidden" id="tab-upload">
            <div class="uploader">
              <input type="file" id="upload-file" accept=".xlsx,.xls" />
              <div class="upload-options">
                <label
                  ><input
                    type="checkbox"
                    id="opt-allow-missing-status"
                    checked
                  />
                  <span>상태 필드 없어도 업로드 허용</span></label
                >
                <fieldset>
                  <legend>상태 변경</legend>
                  <label
                    ><input
                      type="radio"
                      name="opt-status-mode"
                      value="none"
                      checked
                    />
                    <span>변경 없음</span></label
                  >
                  <label
                    ><input
                      type="radio"
                      name="opt-status-mode"
                      value="all-support"
                    />
                    <span>업로드된 인원 전부 ‘지원’</span></label
                  >
                </fieldset>
              </div>
              <div class="upload-preview" id="upload-preview"></div>
              <div class="modal-buttons upload-actions">
                <button class="btn" id="btn-upload-dryrun">
                  <i class="fas fa-eye"></i> 미리보기
                </button>
                <button class="btn btn-primary" id="btn-upload-exec" disabled>
                  <i class="fas fa-cloud-upload-alt"></i> 실행
                </button>
                <button type="button" id="create-modal-close" class="btn">
                  닫기
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="edit-modal" class="modal hidden">
      <form
        id="edit-form"
        class="modal-content"
        role="dialog"
        aria-modal="true"
        aria-label="edit-title"
      >
        <h2 id="edit-title">이용자 정보 수정</h2>

        <input type="hidden" id="edit-id" />

        <label>이름 <input id="edit-name" /></label>
        <label
          >생년월일 <input id="edit-birth" type="text" placeholder="YYYY.MM.DD"
        /></label>

        <label>
          성별
          <div class="custom-select" id="gender-select">
            <div class="selected">선택</div>
            <div class="options hidden">
              <div data-value="남">남</div>
              <div data-value="여">여</div>
            </div>
          </div>
        </label>

        <label>
          상태
          <div class="custom-select" id="status-select">
            <div class="selected">선택</div>
            <div class="options hidden">
              <div data-value="지원">지원</div>
              <div data-value="제외">제외</div>
              <div data-value="사망">사망</div>
            </div>
          </div>
        </label>

        <label>행정구역 <input id="edit-region1" /></label>
        <label>주소 <input id="edit-address" /></label>
        <label>전화번호 <input id="edit-phone" /></label>

        <label>
          이용자구분
          <div class="custom-select" id="type-select">
            <input
              type="text"
              id="edit-type"
              placeholder="직접 입력 또는 선택"
            />
            <div class="options hidden">
              <div data-value="기초생활수급자">기초생활수급자</div>
              <div data-value="기초생활수급탈락자">기초생활수급탈락자</div>
              <div data-value="긴급지원대상자">긴급지원대상자</div>
              <div data-value="저소득층">저소득층</div>
              <div data-value="차상위계층">차상위계층</div>
            </div>
          </div>
        </label>

        <label>
          이용자분류
          <div class="custom-select" id="category-select">
            <input
              type="text"
              id="edit-category"
              placeholder="직접 입력 또는 선택"
            />
            <div class="options hidden">
              <div data-value="기타">기타</div>
              <div data-value="노인부부가구">노인부부가구</div>
              <div data-value="독거노인">독거노인</div>
              <div data-value="부부중심가구">부부중심가구</div>
              <div data-value="재가장애인">재가장애인</div>
              <div data-value="저소득가정">저소득가정</div>
              <div data-value="청장년1인가구">청장년1인가구</div>
              <div data-value="한부모가정">한부모가정</div>
              <div data-value="일반세대">일반세대</div>
            </div>
          </div>
        </label>

        <label>비고 <input id="edit-note" /></label>

        <div class="modal-buttons">
          <button type="submit"><i class="fas fa-save"></i> 저장</button>
          <button type="button" id="close-edit-modal">
            <i class="fas fa-times"></i> 취소
          </button>
        </div>
      </form>
    </div>

    <div id="footer-container"></div>

    <!-- header footer 삽입 -->
    <script type="module">
      import { loadHeader, loadFooter } from "./js/components/comp.js";
      loadHeader("header-container");
      loadFooter("footer-container");
    </script>
  </body>
</html>
