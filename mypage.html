<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>POS System - Mypage</title>

    <!-- 공통 리소스 -->
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/mypage.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css"
    />

    <!-- Firebase -->
    <script type="module" src="js/components/firebase-config.js"></script>
    <!-- Page JS -->
    <script type="module" src="js/mypage.js" defer></script>
  </head>
  <body>
    <div class="wrapper">
      <div id="header-container"></div>

      <main class="mypage-container">
        <!-- 프로필 카드 -->
        <section class="user-card">
          <h2>👨‍💼 직원 정보</h2>
          <p><strong>이름:</strong> <span id="user-name">-</span></p>
          <p><strong>이메일:</strong> <span id="user-email">-</span></p>
          <p>
            <strong>최근 로그인:</strong> <span id="user-last-login">-</span>
          </p>
          <p>
            <span id="admin-badge" class="admin-badge" style="display: none">
              <i class="fas fa-crown"></i> 관리자
            </span>
          </p>
          <button id="logout-btn">로그아웃</button>

          <section
            id="admin-settings"
            class="admin-settings"
            style="display: none"
          >
            <h2>🛠️ 관리자 설정</h2>
            <ul>
              <li>✔️ 사용자 계정 관리</li>
              <li>✔️ 상품 초기화 도구</li>
              <li>✔️ 시스템 로그 보기</li>
            </ul>
          </section>
        </section>

        <!-- 🔗 계정 연동 -->
        <section class="federation-card">
          <h2>🔗 계정 연동</h2>
          <p class="fed-help">
            이메일 계정을 기본으로 사용하고, 소셜 계정은 로그인용으로
            <strong>연동</strong>할 수 있어요.
          </p>

          <div class="link-list">
            <!-- Google -->
            <article class="link-item" data-provider="google">
              <div class="provider">
                <i class="fa-brands fa-google"></i>
                <div>
                  <h3>Google</h3>
                  <div class="status">
                    <span id="status-google" class="status-badge"
                      >확인 중…</span
                    >
                  </div>
                </div>
              </div>
              <div class="actions">
                <button id="link-google" class="btn primary" type="button">
                  연동하기
                </button>
                <button
                  id="unlink-google"
                  class="btn danger hidden"
                  type="button"
                >
                  연동 해지
                </button>
              </div>
            </article>

            <!-- Kakao -->
            <article class="link-item" data-provider="kakao">
              <div class="provider">
                <i class="fa-solid fa-comment"></i>
                <div>
                  <h3>Kakao</h3>
                  <div class="status">
                    <span id="status-kakao" class="status-badge">확인 중…</span>
                  </div>
                </div>
              </div>
              <div class="actions">
                <button id="link-kakao" class="btn primary" type="button">
                  연동하기
                </button>
                <button
                  id="unlink-kakao"
                  class="btn danger hidden"
                  type="button"
                >
                  연동 해지
                </button>
              </div>
            </article>

            <!-- Naver -->
            <article class="link-item" data-provider="naver">
              <div class="provider">
                <i class="fa-solid fa-n"></i>
                <div>
                  <h3>Naver</h3>
                  <div class="status">
                    <span id="status-naver" class="status-badge">확인 중…</span>
                  </div>
                </div>
              </div>
              <div class="actions">
                <button id="link-naver" class="btn primary" type="button">
                  연동하기
                </button>
                <button
                  id="unlink-naver"
                  class="btn danger hidden"
                  type="button"
                >
                  연동 해지
                </button>
              </div>
            </article>
          </div>

          <p class="note">
            ※ 연동 후에는 해당 소셜 버튼으로도 로그인할 수 있습니다. 연동을
            해지하면 로그인에 사용할 수 없습니다.
          </p>
        </section>
      </main>

      <div id="footer-container"></div>
    </div>

    <!-- header/footer 삽입 & toast 컨테이너 보장 -->
    <script type="module">
      import {
        loadHeader,
        loadFooter,
        showToast,
      } from "./js/components/comp.js";
      loadHeader("header-container");
      loadFooter("footer-container");
      if (!document.getElementById("toast")) {
        const el = document.createElement("div");
        el.id = "toast";
        document.body.appendChild(el);
      }
      // 해시로 돌아온 경우(연동 완료/실패) 안내
      if (location.hash) {
        const p = new URLSearchParams(location.hash.slice(1));
        const err = p.get("error"),
          prov = p.get("provider"),
          tok = p.get("token");
        if (err === "not_linked")
          showToast(`해당 ${prov} 계정은 연동되어 있지 않습니다.`, true);
        if (tok && prov?.endsWith("_linked"))
          showToast(`${prov.replace("_linked", "")} 연동이 완료되었습니다.`);
        history.replaceState(null, "", location.pathname + location.search);
      }
    </script>
  </body>
</html>
