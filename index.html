<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>POS System - Login</title>
    <!-- ⚡️ FOUC 방지: 초기 테마 적용 -->
    <script>
      (function () {
        try {
          var t = localStorage.getItem('theme');
          var d = t ? (t === 'dark')
                    : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
          if (d) document.documentElement.classList.add('dark');
        } catch (e) {}
      })();
    </script>

    <link rel="icon" href="data:," />
    <link rel="stylesheet" href="css/index.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      /* 보이는 Turnstile 배치 */
      .turnstile-wrap {
        margin-top: 10px;
        display: flex;
        justify-content: center;
      }
      .modal .turnstile-wrap {
        margin-top: 12px;
      }
    </style>
    <link rel="stylesheet" href="css/tw.css">
</head>
  <body>
    <div class="login-container">
      <h1>POS 시스템 로그인</h1>

      <!-- 이메일 로그인 -->
      <form id="email-form" class="email-form" autocomplete="on">
        <input
          id="email"
          type="email"
          placeholder="이메일"
          required
          autocomplete="email"
          class="input w-full"
        />
        <div class="pw-field">
          <input
            id="password"
            type="password"
            placeholder="비밀번호"
            required
            autocomplete="current-password"
            class="input w-full"
          /><button
            type="button"
            id="login-pw-toggle"
            class="pw-toggle"
            aria-pressed="false"
            aria-label="비밀번호 표시"
          >
            <i class="fa-solid fa-eye" aria-hidden="true"></i>
            <i class="fa-solid fa-eye-slash" aria-hidden="true"></i>
          </button>
        </div>
        <div id="caps-hint-login" class="caps-hint hidden">
          Caps Lock이 켜져 있어요
        </div>

        <!-- ✅ Turnstile(로그인, 보이는 위젯) -->
        <div class="turnstile-wrap">
          <div
            id="ts-login"
            class="cf-turnstile"
            data-sitekey="0x4AAAAAABtE3GFMWF3_Fd4E"
            data-appearance="always"
            data-theme="light"
            data-callback="onTurnstileLogin"
            data-expired-callback="onTurnstileLoginExpired"
            data-error-callback="onTurnstileLoginError"
          ></div>
        </div>

        <button id="email-login-btn" class="login-btn" type="submit">
          이메일로 로그인 <span class="spinner"></span>
        </button>

        <div class="helper-row">
          <button id="email-signup-btn" type="button" class="text-btn">
            계정 만들기
          </button>
          <button id="reset-password-btn" type="button" class="text-btn">
            비밀번호 재설정
          </button>
        </div>

        <label
          style="display: flex; align-items: center; gap: 8px; margin: 6px 0"
        >
          <input id="remember-me" type="checkbox" />
          <span>로그인 유지</span>
        </label>
      </form>

      <div class="divider"><span>또는</span></div>

      <!-- 소셜 로그인 -->
      <div class="social-buttons">
        <button
          id="google-login-btn"
          class="login-btn social google"
          type="button"
        >
          <svg
            viewBox="0 0 533.5 544.3"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <path
              fill="#4285f4"
              d="M533.5 278.4c0-17.6-1.6-34.5-4.7-50.9H272v96.4h146.9c-6.3 34.1-25.5 63-54.5 82.3v68h87.9c51.3-47.3 80.2-116.9 80.2-195.8z"
            />
            <path
              fill="#34a853"
              d="M272 544.3c73.6 0 135.5-24.3 180.6-65.9l-87.9-68c-24.4 16.3-55.7 26-92.7 26-71 0-131.3-47.9-152.9-112.5h-90v70.5C81.2 488.2 170.1 544.3 272 544.3z"
            />
            <path
              fill="#fbbc04"
              d="M119.1 324.9c-5.7-16.3-9-33.8-9-51.5s3.3-35.2 9-51.5v-70.5h-90c-18.2 36.6-28.6 77.7-28.6 122s10.4 85.4 28.6 122l90-70.5z"
            />
            <path
              fill="#ea4335"
              d="M272 107.7c39.9 0 75.9 13.7 104.2 40.7l78.1-78.1C406.8 24.3 344.9 0 272 0 170.1 0 81.2 56.1 44.7 137.9l90 70.5c21.6-64.6 81.9-112.5 137.3-112.5z"
            />
          </svg>
          Google로 로그인
        </button>
        <button
          id="kakao-login-btn"
          class="login-btn social kakao"
          type="button"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <!-- 채팅 말풍선 -->
            <path
              fill="#181600"
              d="M12 3.5c-5.1 0-9.25 3.05-9.25 6.81 0 2.43 1.68 4.53 4.19 5.74l-.92 3.38 3.36-2.25c.72.1 1.46.16 2.22.16 5.1 0 9.25-3.05 9.25-6.81S17.1 3.5 12 3.5z"
            />
          </svg>
          Kakao로 로그인
        </button>
        <button
          id="naver-login-btn"
          class="login-btn social naver"
          type="button"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <!-- 흰색 N 로고 -->
            <path fill="#ffffff" d="M6 4h4.8l3.2 5V4H18v16h-4.8l-3.2-5v5H6z" />
          </svg>
          Naver로 로그인
        </button>
      </div>

      <p id="login-error" class="login-error"></p>
      <p class="login-note">조직 계정 또는 소셜 계정으로 로그인하세요.</p>
    </div>

    <!-- 회원가입 모달 -->
    <div id="signup-modal" class="modal hidden" aria-hidden="true">
      <div
        class="modal-content"
        role="dialog"
        aria-modal="true"
        aria-labelledby="signup-title"
      >
        <h2 id="signup-title">계정 만들기</h2>

        <form id="signup-form" autocomplete="on" onsubmit="return false;">
          <label for="signup-name">이름</label>
          <input
            id="signup-name"
            type="text"
            placeholder="이름 또는 표시명"
            autocomplete="name"
            required
            class="input w-full"
          />

          <label for="signup-email">이메일</label>
          <input
            id="signup-email"
            type="email"
            placeholder="you@example.com"
            required
            autocomplete="email"
            class="input w-full"
          />

          <label for="signup-password">비밀번호</label>
          <div class="pw-field">
            <input
              id="signup-password"
              type="password"
              placeholder="6자 이상"
              required
              autocomplete="new-password"
              class="input w-full"
            /><button
              type="button"
              id="signup-pw-toggle"
              class="pw-toggle"
              aria-pressed="false"
              aria-label="비밀번호 표시"
            >
              <i class="fa-solid fa-eye" aria-hidden="true"></i>
              <i class="fa-solid fa-eye-slash" aria-hidden="true"></i>
            </button>
          </div>
          <div id="caps-hint-signup1" class="caps-hint hidden">
            Caps Lock이 켜져 있어요
          </div>

          <label for="signup-password2">비밀번호 확인</label>
          <div class="pw-field">
            <input
              id="signup-password2"
              type="password"
              placeholder="비밀번호 다시 입력"
              required
              autocomplete="new-password"
              class="input w-full"
            /><button
              type="button"
              id="signup-pw2-toggle"
              class="pw-toggle"
              aria-pressed="false"
              aria-label="비밀번호 표시"
            >
              <i class="fa-solid fa-eye" aria-hidden="true"></i>
              <i class="fa-solid fa-eye-slash" aria-hidden="true"></i>
            </button>
          </div>
          <div id="caps-hint-signup2" class="caps-hint hidden">
            Caps Lock이 켜져 있어요
          </div>

          <div id="pw-strength">강도: -</div>

          <label class="agree-row">
            <input id="signup-agree" type="checkbox" />
            <span>이용 약관과 개인정보 처리방침에 동의합니다.</span>
          </label>

          <!-- ✅ Turnstile(회원가입, 보이는 위젯) -->
          <div class="turnstile-wrap">
            <div
              id="ts-signup"
              class="cf-turnstile"
              data-sitekey="0x4AAAAAABtE3GFMWF3_Fd4E"
              data-appearance="always"
              data-theme="light"
              data-callback="onTurnstileSignup"
              data-expired-callback="onTurnstileSignupExpired"
              data-error-callback="onTurnstileSignupError"
            ></div>
          </div>

          <p id="signup-error"></p>

          <div class="modal-buttons">
            <button id="signup-submit-btn" class="btn" type="button">계정 생성</button>
            <button id="signup-cancel-btn" class="btn" type="button">취소</button>
          </div>
        </form>
      </div>
    </div>

    <!-- 비밀번호 재설정 모달 -->
    <div id="reset-modal" class="modal hidden" aria-hidden="true">
      <div
        class="modal-content"
        role="dialog"
        aria-modal="true"
        aria-labelledby="reset-title"
      >
        <h2 id="reset-title">비밀번호 재설정</h2>
        <form id="reset-form" onsubmit="return false;">
          <label for="reset-email">이메일</label>
          <input
            id="reset-email"
            type="email"
            placeholder="you@example.com"
            required
            autocomplete="email"
            class="input w-full"
          />

          <!-- ✅ Turnstile(재설정, 보이는 위젯) -->
          <div class="turnstile-wrap">
            <div
              id="ts-reset"
              class="cf-turnstile"
              data-sitekey="0x4AAAAAABtE3GFMWF3_Fd4E"
              data-appearance="always"
              data-theme="light"
              data-callback="onTurnstileReset"
              data-expired-callback="onTurnstileResetExpired"
              data-error-callback="onTurnstileResetError"
            ></div>
          </div>

          <p id="reset-error" class="login-error"></p>

          <div class="modal-buttons">
            <button id="reset-submit-btn" class="btn" type="button">
              재설정 메일 보내기
            </button>
            <button id="reset-cancel-btn" class="btn" type="button">취소</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Turnstile 콜백: 토큰 저장 -->
    <script>
      window._tsTokens = { login: null, signup: null, reset: null };
      function onTurnstileLogin(t) {
        window._tsTokens.login = t;
      }
      function onTurnstileSignup(t) {
        window._tsTokens.signup = t;
      }
      function onTurnstileReset(t) {
        window._tsTokens.reset = t;
      }
      function onTurnstileLoginExpired() {
        window._tsTokens.login = null;
      }
      function onTurnstileSignupExpired() {
        window._tsTokens.signup = null;
      }
      function onTurnstileResetExpired() {
        window._tsTokens.reset = null;
      }
      function onTurnstileLoginError() {
        window._tsTokens.login = null;
      }
      function onTurnstileSignupError() {
        window._tsTokens.signup = null;
      }
      function onTurnstileResetError() {
        window._tsTokens.reset = null;
      }
    </script>
    <!-- Cloudflare Turnstile (한국어, 자동 렌더) -->
    <script
      src="https://challenges.cloudflare.com/turnstile/v0/api.js?hl=ko"
      async
      defer
    ></script>

    <!-- 공통 컴포넌트(토스트 등) -->
    <script type="module" src="js/components/comp.js"></script>
    <!-- 로그인 로직 -->
    <script type="module" src="js/login.js"></script>
  </body>
</html>
